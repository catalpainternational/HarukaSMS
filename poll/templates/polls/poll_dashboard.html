{% extends "polls/layout.html" %}
{% block title %}Polls{% endblock %}
{% block javascripts %}
    {{ block.super }}
    <script src="{{MEDIA_URL}}poll/javascripts/polls.js" type="text/javascript"></script>

{% endblock %}
{% block content %}

<div class="polls module">
  <h2>Your Polls</h2>
  <table width="400px" class="bordered-table zebra-striped">
    <thead>
      <tr>
        <th class="poll_name_col">Poll Name</th>
        <th class="poll_question_col">Question</th>
        <th class="poll_date_col">Start Date</th>
        <th class="poll_date_col">Closing Date</th>
        <th class="poll_submissions">Submissions</th>
      </tr>
    </thead>
    <tbody>
      {% if polls %}
      {% for poll_obj in polls %}
      <tr class="bordered-table zebra-striped">
        <td>{{ poll_obj.name }}</td>
        <td><b>{% if poll_obj.start_date %}{{ poll_obj.question }}{% else %}<font color="grey">{{ poll_obj.question }}</font>{% endif %}</b></td>
        <td>{% if poll_obj.start_date %}{{ poll_obj.start_date|date:"d/m/Y" }}{% endif %}</td>
        <td>{% if poll_obj.end_date %}{{ poll_obj.end_date|date:"d/m/Y" }}{% else %}Still Open{% endif %}</td>
        <td>{{ poll_obj.messages.count }}</td>
      </tr>
      {% endfor %}
      {% else %}
      <tr class="poll_table_row">
        <td colspan="5"><i>No existing Polls.  Click 'Add New Poll' to create one.</i></td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>

<div class="messages module">
  <h2>Latest Incoming and Outgoing Messages</h2>
  <div id="message_table">
      {{ messages_table|safe }}
  </div>
  <a class="more_msg" href="/router/console">More Messages</a>
  <script type="text/javascript">
    function update() {
        $.get("/polls/latest_messages", function(data) {
        $("#message_table").html(data);
            window.setTimeout(update, 5000);
        });
    }
    window.setTimeout(update, 5000);

    function reply(number) {
        $('#id_recipient').val(number);
        return void(0);
    }


  </script>
</div>

</div>

{% endblock %}
