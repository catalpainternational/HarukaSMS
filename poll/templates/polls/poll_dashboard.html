{% extends "polls/layout.html" %}
{% block title %}HarukaSMS Dashboard{% endblock %}
{% block javascripts %}
    {{ block.super }}
    <script src="{{MEDIA_URL}}poll/javascripts/polls.js" type="text/javascript"></script>

{% endblock %}
{% block content %}

<div class="polls module">
  <h2>Your Polls</h2>
  <table width="400px" class="bordered-table zebra-striped">
    <thead>
      <tr>
        <th class="poll_name_col">Poll Name</th>
        <th class="poll_question_col">Question</th>
        <th class="poll_date_col">Start Date</th>
        <th class="poll_date_col">Closing Date</th>
        <th class="poll_submissions">Submissions</th>
      </tr>
    </thead>
    <tbody>
      {% if polls %}
      {% for poll in polls %}
      <tr class="bordered-table zebra-striped">
        <td>{{ poll.name }}</td>
        <td><b>{% if poll.start_date %}{{ poll.question }}{% else %}<font color="grey">{{ poll.question }}</font>{% endif %}</b></td>
        <td>{% if poll.start_date %}{{ poll.start_date|date:"d/m/Y" }}{% endif %}</td>
        <td>{% if poll.end_date %}{{ poll.end_date|date:"d/m/Y" }}{% else %}Still Open{% endif %}</td>
        <td>{{ poll.messages.count }} 
            {% if poll.contacts.count > 1 %}
              of {{ poll.contacts.count }} ({% widthratio poll.messages.count poll.contacts.count 100 %}%)
            {% endif %}
           </td>
      </tr>
      {% endfor %}
      {% else %}
      <tr class="poll_table_row">
        <td colspan="5"><i>No existing Polls.  Click 'Add New Poll' to create one.</i></td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>

<div class="sender module">
  <h2>Send Message</h2>
  <form method="POST" class="sender-form">
    {{ reply_form }}
    <input type="hidden" name="action" value="reply" />
    <input type="submit" value="send" />
    {% csrf_token %}
  </form>
  <script language="javascript">
    function reply(number) {
        $('#id_recipient').val(number);
        return void(0);
    }
  </script>
</div>

<div class="messages module">
  <h2>Latest Incoming and Outgoing Messages</h2>
  <div id="message_table">
      {{ messages_table|safe }}
  </div>
  <a class="more_msg" href="/router/console">More Messages</a>
  <script type="text/javascript">
    function update() {
        $.get("/polls/latest_messages", function(data) {
        $("#message_table").html(data);
            window.setTimeout(update, 5000);
        });
    }
    window.setTimeout(update, 5000);

    function reply(number) {
        $('#id_recipient').val(number);
        return void(0);
    }


  </script>
</div>

</div>

{% endblock %}
